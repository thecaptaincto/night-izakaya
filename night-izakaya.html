<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¸ Sakura Izakaya â€” Osaka's Heart</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;600;700&family=Shippori+Mincho:wght@400;600;700&family=IM+Fell+DW+Pica:ital@0;1&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet">
  <style>
    :root {
      --ink: #1a0f0a;
      --deep: #0d0d1a;
      --amber: #e8a030;
      --warm: #c96a1f;
      --sakura: #e8879c;
      --pale-sakura: #fce8ed;
      --cream: #fdf5e8;
      --smoke: rgba(255,255,255,0.06);
      --lantern: #f5c842;
      --indigo: #1e2340;
      --panel: rgba(15,10,5,0.85);
      --border: rgba(232,160,48,0.25);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'Cormorant Garamond', serif;
      background-color: var(--deep);
      color: var(--cream);
      min-height: 100vh;
      overflow-x: hidden;
      cursor: default;
    }

    /* â”€â”€ NOISE TEXTURE OVERLAY â”€â”€ */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
      pointer-events: none;
      opacity: 0.4;
    }

    /* â”€â”€ SAKURA PETALS â”€â”€ */
    #petals-canvas {
      position: fixed; inset: 0; z-index: 1;
      pointer-events: none;
    }

    /* â”€â”€ WRAPPER â”€â”€ */
    .wrapper {
      position: relative; z-index: 2;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* â”€â”€ HERO HEADER â”€â”€ */
    header {
      position: relative;
      min-height: 100vh;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      text-align: center;
      overflow: hidden;
      padding: 60px 20px;
    }

    header::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse 80% 60% at 50% 40%, rgba(201,106,31,0.15) 0%, transparent 70%),
                  radial-gradient(ellipse 60% 80% at 20% 80%, rgba(232,135,156,0.08) 0%, transparent 60%),
                  radial-gradient(ellipse 50% 50% at 80% 20%, rgba(245,200,66,0.06) 0%, transparent 50%);
    }

    .lantern-row {
      display: flex; gap: 60px;
      margin-bottom: 50px;
      animation: swayRow 4s ease-in-out infinite;
    }

    @keyframes swayRow {
      0%,100% { transform: translateX(0); }
      50% { transform: translateX(6px); }
    }

    .lantern {
      width: 36px; height: 58px;
      background: radial-gradient(ellipse at 40% 35%, #fde68a, #f5a623 40%, #c06010 100%);
      border-radius: 50% 50% 45% 45% / 40% 40% 60% 60%;
      position: relative;
      box-shadow: 0 0 20px rgba(245,166,35,0.6), 0 0 50px rgba(245,166,35,0.25);
      animation: lanternFlicker 2.5s ease-in-out infinite;
    }

    .lantern:nth-child(2) { animation-delay: 0.4s; transform: scale(0.85); }
    .lantern:nth-child(3) { animation-delay: 0.8s; transform: scale(1.1); }
    .lantern:nth-child(4) { animation-delay: 1.2s; transform: scale(0.9); }
    .lantern:nth-child(5) { animation-delay: 0.2s; transform: scale(0.95); }

    .lantern::before {
      content: 'ğŸŒ¸';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      font-size: 14px;
      opacity: 0.7;
    }

    .lantern::after {
      content: '';
      position: absolute;
      top: -12px; left: 50%; transform: translateX(-50%);
      width: 2px; height: 12px;
      background: var(--amber);
    }

    @keyframes lanternFlicker {
      0%,100% { box-shadow: 0 0 20px rgba(245,166,35,0.6), 0 0 50px rgba(245,166,35,0.25); opacity: 1; }
      50% { box-shadow: 0 0 30px rgba(245,166,35,0.8), 0 0 70px rgba(245,166,35,0.4); opacity: 0.92; }
    }

    .hero-kana {
      font-family: 'Noto Serif JP', serif;
      font-size: clamp(60px, 12vw, 130px);
      font-weight: 300;
      letter-spacing: 0.15em;
      background: linear-gradient(135deg, #fde68a 0%, #e8a030 35%, #e8879c 65%, #fde68a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      margin-bottom: 8px;
      filter: drop-shadow(0 2px 20px rgba(232,160,48,0.4));
    }

    .hero-en {
      font-family: 'Shippori Mincho', serif;
      font-size: clamp(16px, 3vw, 26px);
      font-weight: 400;
      letter-spacing: 0.5em;
      color: var(--amber);
      text-transform: uppercase;
      margin-bottom: 20px;
    }

    .hero-tagline {
      font-family: 'IM Fell DW Pica', serif;
      font-style: italic;
      font-size: clamp(14px, 2.5vw, 20px);
      color: rgba(253,245,232,0.6);
      letter-spacing: 0.1em;
      margin-bottom: 50px;
    }

    /* â”€â”€ DECORATIVE DIVIDER â”€â”€ */
    .divider {
      display: flex; align-items: center; gap: 16px;
      margin: 40px auto;
      max-width: 400px;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1; height: 1px;
      background: linear-gradient(to right, transparent, var(--amber), transparent);
    }
    .divider-icon { color: var(--sakura); font-size: 18px; }

    /* â”€â”€ NAV STRIP â”€â”€ */
    nav {
      position: sticky; top: 0; z-index: 100;
      background: rgba(10,8,15,0.92);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0;
    }

    .nav-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 24px;
    }

    .nav-logo {
      font-family: 'Noto Serif JP', serif;
      font-size: 22px;
      color: var(--amber);
      padding: 14px 0;
      letter-spacing: 0.1em;
    }

    .nav-links {
      display: flex; gap: 4px;
      list-style: none;
    }

    .nav-links a {
      display: block;
      padding: 16px 14px;
      color: rgba(253,245,232,0.65);
      text-decoration: none;
      font-size: 13px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      font-family: 'Shippori Mincho', serif;
      transition: color 0.2s;
      position: relative;
    }

    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 10px; left: 50%; right: 50%;
      height: 1px;
      background: var(--sakura);
      transition: left 0.25s, right 0.25s;
    }

    .nav-links a:hover { color: var(--cream); }
    .nav-links a:hover::after { left: 14px; right: 14px; }

    .nav-cart-btn {
      background: none; border: 1px solid var(--border);
      color: var(--amber);
      font-family: 'Shippori Mincho', serif;
      font-size: 12px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 8px 18px;
      cursor: pointer;
      border-radius: 2px;
      transition: all 0.2s;
    }
    .nav-cart-btn:hover { background: rgba(232,160,48,0.1); border-color: var(--amber); }

    /* â”€â”€ SECTIONS â”€â”€ */
    section { padding: 80px 0; }

    .section-label {
      font-family: 'Shippori Mincho', serif;
      font-size: 11px;
      letter-spacing: 0.4em;
      text-transform: uppercase;
      color: var(--sakura);
      margin-bottom: 12px;
    }

    .section-title {
      font-family: 'Noto Serif JP', serif;
      font-size: clamp(28px, 5vw, 52px);
      font-weight: 300;
      color: var(--cream);
      letter-spacing: 0.05em;
      line-height: 1.2;
    }

    .section-title span { color: var(--amber); }

    /* â”€â”€ USER STATUS BAR â”€â”€ */
    #user-bar {
      background: rgba(30,20,10,0.7);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 10px 20px;
      margin: 24px 0;
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap; gap: 10px;
      font-size: 13px;
      color: rgba(253,245,232,0.7);
      font-family: 'Shippori Mincho', serif;
      letter-spacing: 0.05em;
    }

    #user-bar strong { color: var(--amber); }

    .user-bar-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn {
      display: inline-block;
      padding: 12px 26px;
      font-family: 'Shippori Mincho', serif;
      font-size: 13px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      cursor: pointer;
      border: none;
      border-radius: 2px;
      transition: all 0.25s;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--warm), var(--amber));
      color: var(--ink);
      font-weight: 700;
      box-shadow: 0 4px 20px rgba(232,160,48,0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(232,160,48,0.5);
    }

    .btn-ghost {
      background: transparent;
      color: var(--cream);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover { border-color: var(--amber); color: var(--amber); }

    .btn-sakura {
      background: rgba(232,135,156,0.15);
      color: var(--sakura);
      border: 1px solid rgba(232,135,156,0.3);
    }
    .btn-sakura:hover { background: rgba(232,135,156,0.25); }

    .btn-danger {
      background: rgba(180,40,40,0.2);
      color: #e87070;
      border: 1px solid rgba(180,40,40,0.3);
    }
    .btn-danger:hover { background: rgba(180,40,40,0.35); }

    .btn-sm {
      padding: 7px 14px;
      font-size: 11px;
    }

    /* â”€â”€ MENU GRID â”€â”€ */
    .menu-tabs {
      display: flex; flex-wrap: wrap; gap: 8px;
      margin-bottom: 36px;
    }

    .menu-tab {
      padding: 10px 22px;
      font-family: 'Shippori Mincho', serif;
      font-size: 12px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: 1px solid var(--border);
      background: transparent;
      color: rgba(253,245,232,0.55);
      cursor: pointer;
      border-radius: 2px;
      transition: all 0.2s;
    }

    .menu-tab:hover { color: var(--cream); border-color: rgba(232,160,48,0.5); }

    .menu-tab.active {
      background: rgba(232,160,48,0.1);
      border-color: var(--amber);
      color: var(--amber);
    }

    .menu-panel { display: none; }
    .menu-panel.active { display: block; }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .menu-card {
      background: rgba(15,10,5,0.6);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 22px;
      position: relative;
      overflow: hidden;
      transition: transform 0.25s, border-color 0.25s, box-shadow 0.25s;
    }

    .menu-card::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse at top left, rgba(232,160,48,0.05), transparent 60%);
      pointer-events: none;
    }

    .menu-card:hover {
      transform: translateY(-3px);
      border-color: rgba(232,160,48,0.45);
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
    }

    .menu-card-emoji {
      font-size: 28px;
      margin-bottom: 10px;
      display: block;
    }

    .menu-card-name {
      font-family: 'Shippori Mincho', serif;
      font-size: 15px;
      font-weight: 600;
      color: var(--cream);
      margin-bottom: 6px;
      letter-spacing: 0.03em;
    }

    .menu-card-desc {
      font-size: 12.5px;
      color: rgba(253,245,232,0.5);
      line-height: 1.6;
      margin-bottom: 14px;
      font-style: italic;
    }

    .menu-card-footer {
      display: flex; align-items: center; justify-content: space-between;
    }

    .menu-card-price {
      font-family: 'Noto Serif JP', serif;
      font-size: 16px;
      color: var(--amber);
      font-weight: 600;
    }

    .menu-card-price small {
      font-size: 10px;
      font-family: 'Shippori Mincho', serif;
      letter-spacing: 0.1em;
      opacity: 0.7;
    }

    .alcoholic-tag {
      font-family: 'Shippori Mincho', serif;
      font-size: 9px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      background: rgba(180,40,40,0.2);
      color: #e87070;
      border: 1px solid rgba(180,40,40,0.3);
      padding: 2px 7px;
      border-radius: 20px;
    }

    /* â”€â”€ DEALS GRID â”€â”€ */
    .deals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .deal-card {
      background: rgba(15,10,5,0.6);
      border: 1px solid rgba(232,135,156,0.2);
      border-radius: 4px;
      padding: 24px;
      position: relative;
      transition: transform 0.25s, border-color 0.25s;
    }

    .deal-card:hover {
      transform: translateY(-3px);
      border-color: rgba(232,135,156,0.45);
    }

    .deal-badge {
      position: absolute; top: -10px; right: 18px;
      background: linear-gradient(135deg, var(--sakura), var(--warm));
      color: white;
      font-family: 'Shippori Mincho', serif;
      font-size: 10px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      padding: 3px 12px;
      border-radius: 20px;
    }

    .deal-card-title {
      font-family: 'Shippori Mincho', serif;
      font-size: 15px;
      font-weight: 600;
      color: var(--sakura);
      margin-bottom: 6px;
    }

    .deal-card-desc {
      font-size: 13px;
      color: rgba(253,245,232,0.55);
      line-height: 1.6;
      margin-bottom: 14px;
      font-style: italic;
    }

    /* â”€â”€ CART SIDEBAR â”€â”€ */
    #cart-overlay {
      position: fixed; inset: 0; z-index: 200;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      display: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    #cart-overlay.open {
      display: flex; justify-content: flex-end;
      opacity: 1;
    }

    #cart-panel {
      width: 420px; max-width: 100vw;
      background: #0f0a05;
      border-left: 1px solid var(--border);
      height: 100%;
      overflow-y: auto;
      display: flex; flex-direction: column;
      transform: translateX(100%);
      transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    }

    #cart-overlay.open #cart-panel { transform: translateX(0); }

    .cart-header {
      padding: 24px;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }

    .cart-title {
      font-family: 'Noto Serif JP', serif;
      font-size: 20px;
      color: var(--amber);
    }

    .cart-close {
      background: none; border: none;
      color: rgba(253,245,232,0.5);
      font-size: 22px; cursor: pointer;
      transition: color 0.2s;
    }
    .cart-close:hover { color: var(--cream); }

    #cart-items-list {
      flex: 1;
      padding: 20px 24px;
      overflow-y: auto;
    }

    .cart-item {
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: flex-start; gap: 12px;
    }

    .cart-item-info { flex: 1; }

    .cart-item-name {
      font-family: 'Shippori Mincho', serif;
      font-size: 13px;
      font-weight: 600;
      color: var(--cream);
      margin-bottom: 2px;
    }

    .cart-item-price {
      font-size: 12px;
      color: var(--amber);
    }

    .cart-item-qty {
      display: flex; align-items: center; gap: 8px;
    }

    .qty-btn {
      width: 26px; height: 26px;
      background: rgba(232,160,48,0.1);
      border: 1px solid var(--border);
      color: var(--amber);
      font-size: 16px;
      cursor: pointer;
      border-radius: 2px;
      display: flex; align-items: center; justify-content: center;
      line-height: 1;
      transition: background 0.2s;
    }
    .qty-btn:hover { background: rgba(232,160,48,0.25); }

    .qty-num {
      font-family: 'Shippori Mincho', serif;
      font-size: 14px;
      min-width: 20px;
      text-align: center;
      color: var(--cream);
    }

    .cart-footer {
      padding: 20px 24px;
      border-top: 1px solid var(--border);
    }

    .cart-subtotal {
      font-family: 'Noto Serif JP', serif;
      font-size: 18px;
      color: var(--cream);
      margin-bottom: 16px;
      display: flex; justify-content: space-between;
    }

    .cart-subtotal span { color: var(--amber); }

    /* â”€â”€ CHECKOUT MODAL â”€â”€ */
    #checkout-modal {
      position: fixed; inset: 0; z-index: 300;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(8px);
      display: none; align-items: center; justify-content: center;
      padding: 20px;
    }
    #checkout-modal.open { display: flex; }

    .modal-panel {
      background: #0f0a05;
      border: 1px solid var(--border);
      border-radius: 6px;
      width: 100%; max-width: 540px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 36px;
    }

    .modal-title {
      font-family: 'Noto Serif JP', serif;
      font-size: 24px;
      color: var(--amber);
      margin-bottom: 24px;
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-label {
      display: block;
      font-family: 'Shippori Mincho', serif;
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: rgba(253,245,232,0.6);
      margin-bottom: 7px;
    }

    .form-input {
      width: 100%;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 10px 14px;
      color: var(--cream);
      font-family: 'Cormorant Garamond', serif;
      font-size: 15px;
      outline: none;
      transition: border-color 0.2s;
    }

    .form-input:focus { border-color: var(--amber); }

    .form-select {
      width: 100%;
      background: rgba(15,10,5,0.9);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 10px 14px;
      color: var(--cream);
      font-family: 'Cormorant Garamond', serif;
      font-size: 15px;
      outline: none;
      cursor: pointer;
    }

    .payment-methods {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 8px;
    }

    .payment-opt {
      padding: 12px 8px;
      border: 1px solid var(--border);
      border-radius: 3px;
      text-align: center;
      cursor: pointer;
      font-family: 'Shippori Mincho', serif;
      font-size: 12px;
      letter-spacing: 0.05em;
      color: rgba(253,245,232,0.6);
      transition: all 0.2s;
    }
    .payment-opt:hover { border-color: rgba(232,160,48,0.5); color: var(--cream); }
    .payment-opt.selected { border-color: var(--amber); background: rgba(232,160,48,0.1); color: var(--amber); }

    .payment-opt-icon { font-size: 20px; display: block; margin-bottom: 4px; }

    .checkout-total-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 0;
      border-top: 1px solid var(--border);
      font-family: 'Noto Serif JP', serif;
      font-size: 20px;
      color: var(--cream);
      margin-top: 8px;
    }
    .checkout-total-row .total-amt { color: var(--amber); }

    /* â”€â”€ AUTH MODAL â”€â”€ */
    #auth-modal {
      position: fixed; inset: 0; z-index: 300;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(8px);
      display: none; align-items: center; justify-content: center;
      padding: 20px;
    }
    #auth-modal.open { display: flex; }

    .auth-tabs {
      display: flex; gap: 0;
      margin-bottom: 28px;
      border-bottom: 1px solid var(--border);
    }

    .auth-tab {
      padding: 10px 24px;
      font-family: 'Shippori Mincho', serif;
      font-size: 12px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      border: none; background: none;
      color: rgba(253,245,232,0.4);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
      transition: all 0.2s;
    }
    .auth-tab.active { color: var(--amber); border-bottom-color: var(--amber); }

    /* â”€â”€ OUTPUT/NOTIFICATION â”€â”€ */
    #toast-container {
      position: fixed;
      bottom: 30px; right: 30px;
      z-index: 500;
      display: flex; flex-direction: column; gap: 10px;
      align-items: flex-end;
    }

    .toast {
      background: rgba(15,10,5,0.95);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 12px 18px;
      font-family: 'Shippori Mincho', serif;
      font-size: 13px;
      color: var(--cream);
      max-width: 300px;
      animation: toastIn 0.3s ease, toastOut 0.3s ease 3.7s forwards;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .toast.success { border-color: rgba(100,200,100,0.4); color: #90e090; }
    .toast.error { border-color: rgba(200,80,80,0.4); color: #e09090; }
    .toast.info { border-color: rgba(232,160,48,0.4); color: var(--amber); }

    @keyframes toastIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes toastOut { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(20px); } }

    /* â”€â”€ ORDER HISTORY â”€â”€ */
    .order-card {
      background: rgba(15,10,5,0.6);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .order-card-header {
      display: flex; justify-content: space-between; align-items: flex-start;
      margin-bottom: 14px;
    }

    .order-code {
      font-family: 'Noto Serif JP', serif;
      font-size: 12px;
      color: var(--amber);
      letter-spacing: 0.08em;
    }

    .order-status {
      font-family: 'Shippori Mincho', serif;
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 3px 10px;
      border-radius: 20px;
      border: 1px solid;
    }
    .status-pending { color: #e8d060; border-color: rgba(232,208,96,0.3); background: rgba(232,208,96,0.08); }
    .status-preparing { color: #60b8e8; border-color: rgba(96,184,232,0.3); background: rgba(96,184,232,0.08); }
    .status-ready { color: #60e890; border-color: rgba(96,232,144,0.3); background: rgba(96,232,144,0.08); }
    .status-completed { color: #a0a0a0; border-color: rgba(160,160,160,0.3); background: rgba(160,160,160,0.08); }
    .status-cancelled { color: #e06060; border-color: rgba(224,96,96,0.3); background: rgba(224,96,96,0.08); }
    .status-cod { color: var(--sakura); border-color: rgba(232,135,156,0.3); background: rgba(232,135,156,0.08); }

    /* â”€â”€ ADMIN SECTION â”€â”€ */
    .admin-panel {
      background: rgba(60,20,80,0.2);
      border: 1px solid rgba(160,80,220,0.25);
      border-radius: 4px;
      padding: 24px;
      margin-top: 20px;
    }

    /* â”€â”€ INFO SECTION â”€â”€ */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
    }

    @media (max-width: 700px) {
      .info-grid { grid-template-columns: 1fr; }
      .nav-links { display: none; }
      .menu-grid { grid-template-columns: 1fr; }
      .payment-methods { grid-template-columns: 1fr 1fr; }
      #cart-panel { width: 100vw; }
    }

    .info-block-title {
      font-family: 'Shippori Mincho', serif;
      font-size: 11px;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--sakura);
      margin-bottom: 10px;
    }

    .info-block-body {
      font-size: 15px;
      color: rgba(253,245,232,0.7);
      line-height: 1.85;
    }

    /* â”€â”€ FOOTER â”€â”€ */
    footer {
      padding: 50px 0 40px;
      border-top: 1px solid var(--border);
      text-align: center;
    }

    .footer-kana {
      font-family: 'Noto Serif JP', serif;
      font-size: 32px;
      font-weight: 300;
      color: var(--amber);
      opacity: 0.4;
      letter-spacing: 0.3em;
    }

    .footer-copy {
      font-size: 12px;
      color: rgba(253,245,232,0.25);
      font-family: 'Shippori Mincho', serif;
      letter-spacing: 0.1em;
      margin-top: 10px;
    }

    /* â”€â”€ ORDER SUCCESS â”€â”€ */
    .order-success {
      text-align: center; padding: 40px 20px;
    }

    .order-success-icon { font-size: 64px; margin-bottom: 20px; display: block; }

    .order-success-code {
      font-family: 'Noto Serif JP', serif;
      font-size: 22px;
      color: var(--amber);
      letter-spacing: 0.1em;
      background: rgba(232,160,48,0.1);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 14px 24px;
      display: inline-block;
      margin: 16px 0;
    }

    /* â”€â”€ HERO BUTTONS â”€â”€ */
    .hero-actions {
      display: flex; gap: 16px; flex-wrap: wrap;
      justify-content: center;
    }

    /* â”€â”€ EMPTY STATES â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: rgba(253,245,232,0.3);
    }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; display: block; }
    .empty-state-text { font-family: 'Shippori Mincho', serif; font-size: 14px; letter-spacing: 0.1em; }

    /* SCROLL REVEAL */
    .reveal {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
</head>
<body>

<!-- Sakura petals canvas -->
<canvas id="petals-canvas"></canvas>

<!-- TOAST NOTIFICATIONS -->
<div id="toast-container"></div>

<!-- CART OVERLAY -->
<div id="cart-overlay">
  <div id="cart-panel">
    <div class="cart-header">
      <div class="cart-title">ğŸ›’ ãŠè²·ã„ç‰©ã‚«ã‚´</div>
      <button class="cart-close" id="cart-close-btn">âœ•</button>
    </div>
    <div id="cart-items-list">
      <div class="empty-state">
        <span class="empty-state-icon">ğŸ›’</span>
        <div class="empty-state-text">Your cart is empty</div>
      </div>
    </div>
    <div class="cart-footer" id="cart-footer" style="display:none;">
      <div class="cart-subtotal">
        <span>Subtotal</span>
        <span id="cart-total-display">Â¥0</span>
      </div>
      <button class="btn btn-primary" style="width:100%;" id="cart-checkout-btn">Proceed to Checkout</button>
    </div>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<div id="checkout-modal">
  <div class="modal-panel" id="checkout-panel">
    <div class="modal-title">ğŸ’³ Checkout</div>
    <div id="checkout-content"></div>
  </div>
</div>

<!-- AUTH MODAL -->
<div id="auth-modal">
  <div class="modal-panel">
    <div class="auth-tabs">
      <button class="auth-tab active" id="tab-login-btn">Login</button>
      <button class="auth-tab" id="tab-register-btn">Register</button>
      <button class="auth-tab" id="tab-guest-btn">Guest</button>
    </div>
    <div id="auth-content">
      <!-- Filled by JS -->
    </div>
  </div>
</div>

<!-- ======================== HERO ======================== -->
<header id="home">
  <div class="lantern-row">
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
    <div class="lantern"></div>
  </div>

  <div style="position:relative;">
    <div class="hero-kana">æ¡œå±…é…’å±‹</div>
    <div class="hero-en">Sakura Izakaya</div>
    <div class="hero-tagline">Osaka's heart, one takoyaki at a time</div>

    <div class="divider"><div class="divider-icon">ğŸŒ¸</div></div>

    <div class="hero-actions">
      <button class="btn btn-primary" onclick="scrollToMenu()">Browse Menu</button>
      <button class="btn btn-ghost" onclick="openAuthModal()">Login / Register</button>
    </div>
  </div>
</header>

<!-- ======================== NAV ======================== -->
<nav>
  <div class="nav-inner">
    <div class="nav-logo">ğŸŒ¸ æ¡œ</div>
    <ul class="nav-links">
      <li><a href="#menu">Menu</a></li>
      <li><a href="#deals">Deals</a></li>
      <li><a href="#merchandise">Merch</a></li>
      <li><a href="#orders">My Orders</a></li>
      <li><a href="#info">Info</a></li>
    </ul>
    <button class="nav-cart-btn" id="nav-cart-btn">ğŸ›’ Cart (<span id="nav-cart-count">0</span>)</button>
  </div>
</nav>

<!-- ======================== MAIN ======================== -->
<main>
  <div class="wrapper">

    <!-- USER STATUS -->
    <div id="user-bar" style="margin-top:30px;">
      <span id="user-greeting">ğŸŒ¸ ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼Loading...</span>
      <div class="user-bar-actions" id="user-bar-actions"></div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€ MENU SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="menu">
      <div class="section-label reveal">ãŠå“æ›¸ã Â· The Menu</div>
      <div class="section-title reveal">What will you <span>savour</span> today?</div>

      <div class="divider reveal"><div class="divider-icon">ğŸ¡</div></div>

      <div class="menu-tabs reveal" id="menu-tabs">
        <button class="menu-tab active" data-panel="takoyaki">Takoyaki</button>
        <button class="menu-tab" data-panel="osaka">Osaka Dishes</button>
        <button class="menu-tab" data-panel="japanese">Japanese Food</button>
        <button class="menu-tab" data-panel="sides">Sides</button>
        <button class="menu-tab" data-panel="drinks">Drinks</button>
        <button class="menu-tab" data-panel="desserts">Desserts</button>
      </div>

      <div id="menu-panels"></div>
    </section>

    <!-- â”€â”€â”€â”€â”€â”€ DEALS SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="deals">
      <div class="section-label reveal">ç‰¹åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ Â· Specials</div>
      <div class="section-title reveal">Today's <span>Deals</span></div>
      <div class="divider reveal"><div class="divider-icon">ğŸ‰</div></div>
      <div class="deals-grid reveal" id="deals-grid"></div>
    </section>

    <!-- â”€â”€â”€â”€â”€â”€ MERCHANDISE SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="merchandise">
      <div class="section-label reveal">ã‚°ãƒƒã‚º Â· Merchandise</div>
      <div class="section-title reveal">Bring Sakura <span>Home</span></div>
      <div class="divider reveal"><div class="divider-icon">ğŸ›ï¸</div></div>
      <div class="menu-grid reveal" id="merch-grid"></div>
    </section>

    <!-- â”€â”€â”€â”€â”€â”€ ORDERS SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="orders">
      <div class="section-label reveal">ã”æ³¨æ–‡å±¥æ­´ Â· Order History</div>
      <div class="section-title reveal">Your <span>Orders</span></div>
      <div class="divider reveal"><div class="divider-icon">ğŸ§¾</div></div>
      <div id="orders-list" class="reveal"></div>
    </section>

    <!-- â”€â”€â”€â”€â”€â”€ ADMIN SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="admin-section" style="display:none;">
      <div class="section-label">ç®¡ç†è€… Â· Admin</div>
      <div class="section-title">Order <span>Management</span></div>
      <div class="divider"><div class="divider-icon">ğŸ‘‘</div></div>
      <div class="admin-panel" id="admin-panel"></div>
    </section>

    <!-- â”€â”€â”€â”€â”€â”€ INFO SECTION â”€â”€â”€â”€â”€â”€ -->
    <section id="info">
      <div class="section-label reveal">ã‚¢ã‚¯ã‚»ã‚¹ Â· Access</div>
      <div class="section-title reveal">Find <span>Us</span></div>
      <div class="divider reveal"><div class="divider-icon">ğŸ“</div></div>
      <div class="info-grid reveal">
        <div>
          <div class="info-block-title">Location</div>
          <div class="info-block-body">
            ğŸ® 1F, 1600 Namba-One Dori<br>
            Naniwa-ku, Osaka-shi<br>
            Osaka 900-001, Japan ğŸ‡¯ğŸ‡µ<br><br>
            Tucked near the lively streets of Dotonbori â€” follow the lanterns and the aroma of grilled skewers.
          </div>
        </div>
        <div>
          <div class="info-block-title">About Us</div>
          <div class="info-block-body">
            We're a small, family-run izakaya built on Osaka's street food spirit â€” friendly, flavorful, and full of heart. â¤ï¸<br><br>
            Rooted in the warmth of <em>omotenashi</em> (Japanese hospitality), we welcome you with open arms and hot plates of comfort food. ğŸŒ¸<br><br>
            Come for the food ğŸ¢ â€” stay for the feeling. âœ¨
          </div>
        </div>
      </div>
    </section>

  </div><!-- /wrapper -->
</main>

<!-- ======================== FOOTER ======================== -->
<footer>
  <div class="wrapper">
    <div class="footer-kana">æ¡œå±…é…’å±‹</div>
    <div class="footer-copy">Â© 2025 Sakura Izakaya, Osaka Â· ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ</div>
  </div>
</footer>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const storeName = "SAKURA IZAKAYA";
const adminPassword = "#Osaka2027doriSFO";
const ADMIN_SECRET = "PISBIND5BBOAIVSV";
const USERS_KEY = 'izakaya_users';
const ORDERS_KEY = 'izakaya_orders';

const izakayaMenuData = {
  "Classic Takoyaki": { price:90, emoji:"ğŸ¡", desc:"Osaka's signature street food. Crispy outside, fluffy inside, topped with sauce, mayo, bonito flakes, and seaweed." },
  "Cheese Takoyaki": { price:120, emoji:"ğŸ§€", desc:"Gooey cheese and octopus inside, melty cheese on top." },
  "Mentaiko Takoyaki": { price:130, emoji:"ğŸŒ¶ï¸", desc:"Spicy pollock roe filling, seaweed, and spicy sauce." },
  "Spicy Takoyaki": { price:110, emoji:"ğŸ”¥", desc:"JalapeÃ±os and chili flakes, spicy mayo drizzle." },
  "Negi Mayo Takoyaki": { price:130, emoji:"ğŸ§…", desc:"Green onion and creamy mayo topping." },
  "Kimchi Takoyaki": { price:135, emoji:"ğŸŒ¶ï¸", desc:"Tangy kimchi meets classic takoyaki." },
  "Bacon Takoyaki": { price:140, emoji:"ğŸ¥“", desc:"Smoky bacon bits inside and on top." },
  "Shrimp/Crab Takoyaki": { price:150, emoji:"ğŸ¦", desc:"Real shrimp or crab, tangy sauce." },
  "Teriyaki Takoyaki": { price:125, emoji:"ğŸ¶", desc:"Sweet-savory teriyaki glaze." },
  "Curry Takoyaki": { price:120, emoji:"ğŸ›", desc:"Japanese curry sauce, mild spice." },
  "Soy Sauce Takoyaki": { price:115, emoji:"ğŸ«™", desc:"Simple, classic shoyu drizzle." },
  "Okonomiyaki": { price:1100, emoji:"ğŸ¥¢", desc:"Osaka's famous savory pancake with cabbage, pork, bonito flakes, and okonomiyaki sauce." },
  "Negiyaki": { price:900, emoji:"ğŸ§…", desc:"Green onion pancake, soy sauce, beef or pork." },
  "Kushikatsu": { price:500, emoji:"ğŸ¢", desc:"Deep-fried skewers of meat, seafood, and veggies, tangy dipping sauce." },
  "Yakisoba": { price:700, emoji:"ğŸœ", desc:"Stir-fried noodles with pork, cabbage, sweet-savory sauce, pickled ginger." },
  "Doteyaki": { price:600, emoji:"ğŸ²", desc:"Beef tendon simmered in miso and mirin, rich umami." },
  "Horumon": { price:800, emoji:"ğŸ”¥", desc:"Grilled beef or pork offal, smoky and rich." },
  "Ikayaki": { price:400, emoji:"ğŸ¦‘", desc:"Grilled whole squid, soy sauce, sliced hot off the grill." },
  "Default Bento Box": { price:750, emoji:"ğŸ±", desc:"Rice, grilled salmon, pickled radish, grapes, soy sauce, seaweed." },
  "Gyoza": { price:400, emoji:"ğŸ¥Ÿ", desc:"Crispy pan-fried dumplings stuffed with pork and veggies, dipping sauce." },
  "Karaage": { price:750, emoji:"ğŸ—", desc:"Juicy Japanese fried chicken, ginger and garlic marinade." },
  "Ramen": { price:900, emoji:"ğŸœ", desc:"Pork broth, chashu, egg, green onions." },
  "Sashimi": { price:300, emoji:"ğŸŸ", desc:"Fresh raw fish slices, soy sauce and wasabi." },
  "Soba": { price:700, emoji:"ğŸŒ¾", desc:"Buckwheat noodles, chilled or hot broth." },
  "Tempura": { price:1000, emoji:"ğŸ¤", desc:"Lightly battered fried shrimp and veggies, tentsuyu sauce." },
  "Udon": { price:800, emoji:"ğŸ²", desc:"Thick wheat noodles, dashi broth, green onions, tempura bits." },
  "Onigiri": { price:250, emoji:"ğŸ™", desc:"Rice balls, choice of filling (tuna, salmon, plum, etc), wrapped in nori." }
};

const drinkMenu = [
  { name:"Sapporo Beer", price:600, alcoholic:true, emoji:"ğŸº", desc:"Classic Japanese lager, crisp and refreshing." },
  { name:"Umeshu Plum Wine", price:700, alcoholic:true, emoji:"ğŸ¶", desc:"Sweet and tangy plum wine, served chilled." },
  { name:"Sake (Hot/Cold)", price:800, alcoholic:true, emoji:"ğŸ¶", desc:"Traditional rice wine, choose hot or cold." },
  { name:"Highball (Whisky & Soda)", price:650, alcoholic:true, emoji:"ğŸ¥ƒ", desc:"Japanese whisky with soda, light and fizzy." },
  { name:"Shochu Lemon Sour", price:650, alcoholic:true, emoji:"ğŸ‹", desc:"Shochu with lemon and soda, tart and refreshing." },
  { name:"Calpis Soda", price:350, alcoholic:false, emoji:"ğŸ¥¤", desc:"Sweet, milky soda, a Japanese favorite." },
  { name:"Oolong Tea", price:300, alcoholic:false, emoji:"ğŸµ", desc:"Classic unsweetened Japanese tea." },
  { name:"Ramune", price:350, alcoholic:false, emoji:"ğŸ¥¤", desc:"Fizzy marble soda, fun and nostalgic." }
];

const dessertMenu = [
  { name:"Mochi Ice Cream", price:400, emoji:"ğŸ¡", desc:"Chewy mochi filled with ice cream, assorted flavors." },
  { name:"Dorayaki", price:350, emoji:"ğŸ¥", desc:"Sweet pancake sandwich with red bean filling." },
  { name:"Matcha Pudding", price:380, emoji:"ğŸµ", desc:"Creamy green tea pudding, lightly sweet." },
  { name:"Seasonal Fruit Plate", price:450, emoji:"ğŸ“", desc:"Fresh, sliced fruit of the season." },
  { name:"Sakura Mochi Ice Cream", price:350, emoji:"ğŸŒ¸", desc:"Limited-time sakura mochi ice cream." }
];

const sideMenu = [
  { name:"Edamame", price:350, emoji:"ğŸŒ±", desc:"Steamed and salted green soybeans." },
  { name:"Agedashi Tofu", price:400, emoji:"ğŸ²", desc:"Crispy fried tofu in savory broth." },
  { name:"Tsukemono", price:300, emoji:"ğŸ¥’", desc:"Assorted Japanese pickles." },
  { name:"Seaweed Salad", price:350, emoji:"ğŸ¥—", desc:"Marinated seaweed with sesame." },
  { name:"Potato Croquette", price:380, emoji:"ğŸ¥”", desc:"Crispy breaded mashed potato patty." }
];

const merchandiseMenu = [
  { name:"Takoyaki Plushie", price:2500, emoji:"ğŸ§¸", desc:"Cute takoyaki plushie, perfect for cuddling or display." },
  { name:"Sakura Mug", price:2200, emoji:"â˜•", desc:"Ceramic mug with sakura and takoyaki illustration." },
  { name:"Izakaya T-Shirt", price:3500, emoji:"ğŸ‘•", desc:"Soft cotton tee with takoyaki mascot." },
  { name:"Tote Bag", price:1600, emoji:"ğŸ‘œ", desc:"Reusable tote bag with takoyaki and sakura design." },
  { name:"Chopsticks + Holder", price:1300, emoji:"ğŸ¥¢", desc:"Set of chopsticks with a cute holder." },
  { name:"Keychain", price:1300, emoji:"ğŸ—ï¸", desc:"Takoyaki ball keychain." },
  { name:"Sticker Pack", price:900, emoji:"ğŸ·ï¸", desc:"Pack of cute takoyaki and Osaka stickers." },
  { name:"Enamel Pin", price:1200, emoji:"ğŸ“Œ", desc:"Takoyaki enamel pin for bags or jackets." },
  { name:"Apron", price:1800, emoji:"ğŸ‘©â€ğŸ³", desc:"Osaka Sakura Izakaya apron, stylish and practical." },
  { name:"Notebook/Journal", price:1100, emoji:"ğŸ““", desc:"Sakura Izakaya themed notebook/journal." },
  { name:"Phone Case", price:1800, emoji:"ğŸ“±", desc:"Takoyaki-themed phone case (various models)." },
  { name:"DIY Sauces Kit", price:2000, emoji:"ğŸ§‚", desc:"Make your own takoyaki sauces and seasonings at home!" },
  { name:"Art Print", price:2200, emoji:"ğŸ–¼ï¸", desc:"Osaka street food art print for your wall." },
  { name:"Mini Tsutenkaku Tower", price:1500, emoji:"ğŸ—¼", desc:"Miniature Tsutenkaku tower souvenir." },
  { name:"Osaka Castle Keychain", price:1000, emoji:"ğŸ¯", desc:"Osaka Castle keychain, iconic landmark." },
  { name:"Osaka Postcard Set", price:800, emoji:"âœ‰ï¸", desc:"Set of 5 Osaka-themed postcards." },
  { name:"Napkins (Set of 5)", price:700, emoji:"ğŸ§»", desc:"Set of 5 themed napkins, reusable and eco-friendly." },
  { name:"Takoyaki Box (Empty)", price:800, emoji:"ğŸ“¦", desc:"Authentic takoyaki box for your own creations." }
];

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let orders = [];
let users = [];
let currentUser = null;
let cartItems = [];
let isAdmin = false;
let selectedPayment = null;

function saveData(key, data) { try { localStorage.setItem(key, JSON.stringify(data)); } catch(e){} }
function loadData(key) { try { const d=localStorage.getItem(key); return d?JSON.parse(d):[]; } catch(e){ return []; } }

function hashPassword(password) {
  let hash=0;
  for(let i=0;i<password.length;i++){ hash=((hash<<5)-hash)+password.charCodeAt(i); hash|=0; }
  return hash.toString(16);
}

function generateOrderCode() {
  const kana=["ã‚","ã„","ã†","ãˆ","ãŠ","ã‹","ã","ã","ã‘","ã“","ã•","ã—","ã™","ã›","ã","ãŸ","ã¡","ã¤","ã¦","ã¨"];
  const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  let rest="";
  for(let i=0;i<11;i++) rest+=chars[Math.floor(Math.random()*chars.length)];
  return `${kana[Math.floor(Math.random()*kana.length)]}-${rest}`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TOAST
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg, type='info') {
  const c=document.getElementById('toast-container');
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  t.textContent=msg;
  c.appendChild(t);
  setTimeout(()=>t.remove(), 4200);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CART
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getCartSubtotal() { return cartItems.reduce((s,i)=>s+i.price*i.quantity,0); }
function getCartCount() { return cartItems.reduce((s,i)=>s+i.quantity,0); }

function addToCart(name, price, qty=1, locked=false, custom={}) {
  let ex=cartItems.find(i=>i.name===name&&i.locked===locked&&JSON.stringify(i.custom)===JSON.stringify(custom));
  if(ex) ex.quantity+=qty;
  else cartItems.push({name,price,quantity:qty,locked,custom});
  toast(`${qty}Ã— ${name} added to cart Â· Â¥${price*qty}`, 'success');
  renderCart();
  updateNavCart();
}

function removeFromCart(idx) {
  cartItems.splice(idx,1);
  renderCart(); updateNavCart();
}

function updateQty(idx, delta) {
  cartItems[idx].quantity+=delta;
  if(cartItems[idx].quantity<=0) cartItems.splice(idx,1);
  renderCart(); updateNavCart();
}

function updateNavCart() {
  document.getElementById('nav-cart-count').textContent=getCartCount();
}

function renderCart() {
  const list=document.getElementById('cart-items-list');
  const footer=document.getElementById('cart-footer');
  const totalDisplay=document.getElementById('cart-total-display');

  if(cartItems.length===0){
    list.innerHTML=`<div class="empty-state"><span class="empty-state-icon">ğŸ›’</span><div class="empty-state-text">Your cart is empty</div></div>`;
    footer.style.display='none';
    return;
  }

  footer.style.display='block';
  totalDisplay.textContent=`Â¥${getCartSubtotal().toLocaleString()}`;

  list.innerHTML=cartItems.map((item,i)=>`
    <div class="cart-item">
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}${item.locked?' ğŸ”’':''}</div>
        <div class="cart-item-price">Â¥${item.price.toLocaleString()} each Â· Â¥${(item.price*item.quantity).toLocaleString()}</div>
        ${item.custom&&item.custom.content?`<div style="font-size:11px;color:rgba(253,245,232,0.4);margin-top:3px;">${item.custom.content}</div>`:''}
      </div>
      <div class="cart-item-qty">
        ${item.locked?`<span style="font-size:12px;color:rgba(253,245,232,0.35);">fixed</span>`:`
          <button class="qty-btn" onclick="updateQty(${i},-1)">âˆ’</button>
          <span class="qty-num">${item.quantity}</span>
          <button class="qty-btn" onclick="updateQty(${i},+1)">+</button>
        `}
        <button class="qty-btn" style="color:#e07070;" onclick="removeFromCart(${i})">ğŸ—‘</button>
      </div>
    </div>
  `).join('');
}

function openCart() {
  const overlay=document.getElementById('cart-overlay');
  overlay.style.display='flex';
  requestAnimationFrame(()=>overlay.classList.add('open'));
  renderCart();
}

function closeCart() {
  const overlay=document.getElementById('cart-overlay');
  overlay.classList.remove('open');
  setTimeout(()=>overlay.style.display='none',350);
}

document.getElementById('cart-close-btn').addEventListener('click',closeCart);
document.getElementById('cart-overlay').addEventListener('click',(e)=>{ if(e.target===e.currentTarget)closeCart(); });
document.getElementById('nav-cart-btn').addEventListener('click',openCart);
document.getElementById('cart-checkout-btn').addEventListener('click',()=>{ closeCart(); setTimeout(openCheckout,400); });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CHECKOUT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openCheckout() {
  if(cartItems.length===0){ toast('Your cart is empty','error'); return; }
  selectedPayment=null;
  renderCheckout();
  document.getElementById('checkout-modal').classList.add('open');
}

function closeCheckout() {
  document.getElementById('checkout-modal').classList.remove('open');
}

function renderCheckout() {
  const subtotal=getCartSubtotal();
  let discount=0;
  if(currentUser&&currentUser.email){
    const prev=orders.filter(o=>o.email===currentUser.email);
    if(prev.length===0) discount=Math.round(subtotal*0.1);
  }
  const total=subtotal-discount;

  document.getElementById('checkout-content').innerHTML=`
    <div class="form-group">
      <label class="form-label">Order Summary</label>
      <div style="background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:3px;padding:14px;font-size:13px;color:rgba(253,245,232,0.65);">
        ${cartItems.map(i=>`<div style="display:flex;justify-content:space-between;padding:4px 0;">${i.quantity}Ã— ${i.name}<span style="color:var(--amber);">Â¥${(i.price*i.quantity).toLocaleString()}</span></div>`).join('')}
        ${discount?`<div style="display:flex;justify-content:space-between;padding:4px 0;color:#90e090;">First-time 10% discount<span>âˆ’Â¥${discount.toLocaleString()}</span></div>`:''}
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Delivery Name</label>
      <input type="text" class="form-input" id="co-name" placeholder="Your name" value="${currentUser?.name||''}">
    </div>

    ${!currentUser?.email?`
    <div class="form-group">
      <label class="form-label">Email (optional, for order tracking)</label>
      <input type="email" class="form-input" id="co-email" placeholder="your@email.com">
    </div>`:''}

    <div class="form-group">
      <label class="form-label">Payment Method</label>
      <div class="payment-methods">
        <div class="payment-opt" data-method="card" onclick="selectPayment(this)">
          <span class="payment-opt-icon">ğŸ’³</span>Card
        </div>
        <div class="payment-opt" data-method="paypay" onclick="selectPayment(this)">
          <span class="payment-opt-icon">ğŸ“±</span>PayPay
        </div>
        <div class="payment-opt" data-method="cash" onclick="selectPayment(this)">
          <span class="payment-opt-icon">ğŸ’´</span>Cash/COD
        </div>
      </div>
    </div>

    <div id="payment-fields"></div>

    <div class="checkout-total-row">
      <span>Total Due</span>
      <span class="total-amt">Â¥${total.toLocaleString()}</span>
    </div>

    <div style="display:flex;gap:12px;margin-top:16px;">
      <button class="btn btn-ghost" onclick="closeCheckout()">Cancel</button>
      <button class="btn btn-primary" style="flex:1;" onclick="confirmOrder(${total},${discount})">Confirm Order</button>
    </div>
  `;
}

function selectPayment(el) {
  document.querySelectorAll('.payment-opt').forEach(e=>e.classList.remove('selected'));
  el.classList.add('selected');
  selectedPayment=el.dataset.method;

  const fields=document.getElementById('payment-fields');
  if(selectedPayment==='card'){
    fields.innerHTML=`
      <div class="form-group">
        <label class="form-label">Card Number</label>
        <input type="text" class="form-input" id="card-num" placeholder="1234 5678 9012 3456" maxlength="19"
          oninput="this.value=this.value.replace(/[^\d\s]/g,'')">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group">
          <label class="form-label">Expiry</label>
          <input type="text" class="form-input" id="card-exp" placeholder="MM/YY" maxlength="5">
        </div>
        <div class="form-group">
          <label class="form-label">CVV</label>
          <input type="text" class="form-input" id="card-cvv" placeholder="123" maxlength="3">
        </div>
      </div>
    `;
  } else if(selectedPayment==='paypay'){
    fields.innerHTML=`<div class="form-group"><label class="form-label">PayPay ID</label><input type="text" class="form-input" id="paypay-id" placeholder="Your PayPay ID"></div>`;
  } else {
    fields.innerHTML=`<div style="padding:12px 0;font-size:13px;color:rgba(253,245,232,0.5);font-style:italic;">Please pay at the counter or upon delivery.</div>`;
  }
}

function confirmOrder(total, discount) {
  if(!selectedPayment){ toast('Please select a payment method','error'); return; }

  if(selectedPayment==='card'){
    const num=(document.getElementById('card-num')?.value||'').replace(/\s/g,'');
    const cvv=document.getElementById('card-cvv')?.value||'';
    if(!/^\d{16}$/.test(num)||!/^\d{3}$/.test(cvv)){ toast('Invalid card details','error'); return; }
  } else if(selectedPayment==='paypay'){
    const id=document.getElementById('paypay-id')?.value||'';
    if(id.length<3){ toast('Invalid PayPay ID','error'); return; }
  }

  const name=document.getElementById('co-name')?.value||currentUser?.name||'Guest';
  const emailField=document.getElementById('co-email');
  const email=emailField?.value||currentUser?.email||null;
  const status=selectedPayment==='cash'?'Cash On Delivery':'Pending';
  const orderCode=generateOrderCode();
  const subtotal=getCartSubtotal();

  orders.push({ customer:name, email, orderCode, items:[...cartItems], subtotal, discount, total, status, date:new Date().toISOString(), paymentMethod:selectedPayment });
  saveData(ORDERS_KEY, orders);
  cartItems=[];
  renderCart();
  updateNavCart();

  document.getElementById('checkout-content').innerHTML=`
    <div class="order-success">
      <span class="order-success-icon">ğŸŒ¸</span>
      <div style="font-family:'Shippori Mincho',serif;font-size:14px;letter-spacing:0.2em;text-transform:uppercase;color:rgba(253,245,232,0.6);margin-bottom:8px;">Order Confirmed!</div>
      <div class="order-success-code">${orderCode}</div>
      <div style="font-size:14px;color:rgba(253,245,232,0.55);margin:10px 0 24px;">Total: Â¥${total.toLocaleString()} Â· ${status}</div>
      <div style="color:rgba(253,245,232,0.4);font-style:italic;font-size:14px;margin-bottom:28px;">ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼Thank you so much! ğŸ™</div>
      <button class="btn btn-primary" onclick="closeCheckout();renderOrderHistory()">View My Orders</button>
    </div>
  `;
  toast(`Order confirmed! Code: ${orderCode}`, 'success');
  renderOrderHistory();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AUTH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentAuthTab = 'login';

function openAuthModal() {
  document.getElementById('auth-modal').classList.add('open');
  renderAuthTab('login');
}

function closeAuthModal() { document.getElementById('auth-modal').classList.remove('open'); }

document.getElementById('auth-modal').addEventListener('click',(e)=>{ if(e.target===e.currentTarget)closeAuthModal(); });

document.getElementById('tab-login-btn').addEventListener('click',()=>{ setAuthTab('login'); });
document.getElementById('tab-register-btn').addEventListener('click',()=>{ setAuthTab('register'); });
document.getElementById('tab-guest-btn').addEventListener('click',()=>{ setAuthTab('guest'); });

function setAuthTab(tab) {
  currentAuthTab=tab;
  document.querySelectorAll('.auth-tab').forEach(el=>el.classList.remove('active'));
  document.getElementById(`tab-${tab}-btn`).classList.add('active');
  renderAuthTab(tab);
}

function renderAuthTab(tab) {
  const c=document.getElementById('auth-content');
  if(tab==='login'){
    c.innerHTML=`
      <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="auth-email" placeholder="your@email.com"></div>
      <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"></div>
      <button class="btn btn-primary" style="width:100%;margin-top:8px;" onclick="doLogin()">Login</button>
    `;
  } else if(tab==='register'){
    c.innerHTML=`
      <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" id="reg-name" placeholder="Your name"></div>
      <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="reg-email" placeholder="your@email.com"></div>
      <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="reg-password" placeholder="Min 4 characters"></div>
      <div class="form-group"><label class="form-label">Age</label><input type="number" class="form-input" id="reg-age" placeholder="Your age" min="1" max="120"></div>
      <button class="btn btn-primary" style="width:100%;margin-top:8px;" onclick="doRegister()">Create Account</button>
    `;
  } else {
    c.innerHTML=`
      <div style="text-align:center;padding:20px 0;">
        <div style="font-size:48px;margin-bottom:16px;">ğŸŒ¸</div>
        <div style="font-family:'IM Fell DW Pica',serif;font-style:italic;color:rgba(253,245,232,0.65);font-size:16px;margin-bottom:24px;">Welcome, honoured guest!<br>Browse freely and enjoy.</div>
        <button class="btn btn-primary" onclick="continueAsGuest()">Continue as Guest</button>
      </div>
    `;
  }
}

function doLogin() {
  const email=(document.getElementById('auth-email')?.value||'').trim().toLowerCase();
  const pass=(document.getElementById('auth-password')?.value||'');
  const user=users.find(u=>u.email===email&&u.password===hashPassword(pass));
  if(!user){ toast('Invalid credentials','error'); return; }
  currentUser=user; isAdmin=false;
  toast(`Welcome back, ${user.name}! ğŸŒ¸`,'success');
  closeAuthModal(); updateUserBar(); renderOrderHistory();
}

function doRegister() {
  const name=(document.getElementById('reg-name')?.value||'').trim();
  const email=(document.getElementById('reg-email')?.value||'').trim().toLowerCase();
  const pass=(document.getElementById('reg-password')?.value||'');
  const age=parseInt(document.getElementById('reg-age')?.value)||18;
  if(!name||!email||!pass){ toast('Please fill all fields','error'); return; }
  if(pass.length<4){ toast('Password too short (min 4 chars)','error'); return; }
  if(users.find(u=>u.email===email)){ toast('Email already registered','error'); return; }
  users.push({email,password:hashPassword(pass),name,age});
  saveData(USERS_KEY,users);
  currentUser={email,name,age}; isAdmin=false;
  toast(`Account created! Welcome, ${name}! ğŸ‰`,'success');
  closeAuthModal(); updateUserBar(); renderOrderHistory();
}

function continueAsGuest() {
  currentUser={name:'Guest',age:18,email:null}; isAdmin=false;
  toast('Browsing as Guest ğŸœ','info');
  closeAuthModal(); updateUserBar();
}

function doAdminLogin() {
  const pwd=prompt('Admin Password:');
  if(pwd!==adminPassword){ toast('Wrong admin password','error'); return; }
  const otp=prompt('DEMO OTP (10-19):');
  const required=(new Date().getMinutes()%10)+10;
  if(parseInt(otp)!==required){ toast('Wrong OTP','error'); return; }
  isAdmin=true;
  currentUser={name:'CaptainCTO-kun',age:30,email:'admin@izakaya.shop'};
  toast('ğŸ‘‘ Admin access granted!','success');
  updateUserBar(); renderAdminPanel();
  document.getElementById('admin-section').style.display='block';
}

function doLogout() {
  currentUser={name:'Guest',age:18,email:null}; isAdmin=false; cartItems=[];
  renderCart(); updateNavCart(); updateUserBar();
  document.getElementById('admin-section').style.display='none';
  toast('Logged out. See you soon! ğŸŒ¸','info');
}

function updateUserBar() {
  const greeting=document.getElementById('user-greeting');
  const actions=document.getElementById('user-bar-actions');
  if(currentUser?.email){
    greeting.innerHTML=`ğŸŒ¸ ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€<strong>${currentUser.name}</strong>-sanï¼${isAdmin?'<span style="color:#c080f0;">ğŸ‘‘ Admin</span>':''}`;
    actions.innerHTML=`
      <button class="btn btn-ghost btn-sm" onclick="openAuthModal()">Account</button>
      <button class="btn btn-ghost btn-sm" onclick="doLogout()">Logout</button>
      ${isAdmin?'':`<button class="btn btn-sm" style="background:rgba(100,60,160,0.2);color:#c080f0;border:1px solid rgba(100,60,160,0.3);" onclick="doAdminLogin()">Admin</button>`}
    `;
  } else {
    greeting.innerHTML=`ğŸŒ¸ ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ï¼Welcome, Guest-sanï¼`;
    actions.innerHTML=`
      <button class="btn btn-primary btn-sm" onclick="openAuthModal()">Login / Register</button>
      <button class="btn btn-sm" style="background:rgba(100,60,160,0.2);color:#c080f0;border:1px solid rgba(100,60,160,0.3);" onclick="doAdminLogin()">Admin</button>
    `;
  }
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MENU RENDERING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMenuCard(name, price, emoji, desc, extra='') {
  return `
    <div class="menu-card">
      <span class="menu-card-emoji">${emoji}</span>
      <div class="menu-card-name">${name}</div>
      <div class="menu-card-desc">${desc}</div>
      <div class="menu-card-footer">
        <div class="menu-card-price">Â¥${price.toLocaleString()} <small>JPY</small></div>
        ${extra}
        <button class="btn btn-primary btn-sm" onclick="quickAdd('${name.replace(/'/g,"\\'")}',${price})">+ Add</button>
      </div>
    </div>
  `;
}

function quickAdd(name, price) {
  // Age check for alcohol
  const drink = drinkMenu.find(d=>d.name===name);
  if(drink?.alcoholic && (currentUser?.age||0)<20){
    toast('Must be 20+ to order alcoholic drinks in Japan ğŸº','error'); return;
  }
  addToCart(name, price, 1);
}

function renderAllMenus() {
  const panels = document.getElementById('menu-panels');

  // Takoyaki panel
  const takoyakiItems = ["Classic Takoyaki","Cheese Takoyaki","Mentaiko Takoyaki","Spicy Takoyaki","Negi Mayo Takoyaki","Kimchi Takoyaki","Bacon Takoyaki","Shrimp/Crab Takoyaki","Teriyaki Takoyaki","Curry Takoyaki","Soy Sauce Takoyaki"];
  const osakaItems = ["Okonomiyaki","Negiyaki","Kushikatsu","Yakisoba","Doteyaki","Horumon","Ikayaki"];
  const japaneseItems = ["Default Bento Box","Gyoza","Karaage","Ramen","Sashimi","Soba","Tempura","Udon","Onigiri"];

  const takoyakiHTML = `<div class="menu-panel active" id="panel-takoyaki"><div class="menu-grid">${takoyakiItems.map(n=>{ const d=izakayaMenuData[n]; return renderMenuCard(n,d.price,d.emoji,d.desc); }).join('')}</div></div>`;
  const osakaHTML = `<div class="menu-panel" id="panel-osaka"><div class="menu-grid">${osakaItems.map(n=>{ const d=izakayaMenuData[n]; return renderMenuCard(n,d.price,d.emoji,d.desc); }).join('')}</div></div>`;
  const japaneseHTML = `<div class="menu-panel" id="panel-japanese"><div class="menu-grid">${japaneseItems.map(n=>{ const d=izakayaMenuData[n]; return renderMenuCard(n,d.price,d.emoji,d.desc); }).join('')}</div></div>`;
  const sidesHTML = `<div class="menu-panel" id="panel-sides"><div class="menu-grid">${sideMenu.map(i=>renderMenuCard(i.name,i.price,i.emoji,i.desc)).join('')}</div></div>`;
  const drinksHTML = `<div class="menu-panel" id="panel-drinks"><div class="menu-grid">${drinkMenu.map(i=>renderMenuCard(i.name,i.price,i.emoji,i.desc,i.alcoholic?'<span class="alcoholic-tag">21+</span>':'')).join('')}</div></div>`;
  const dessertsHTML = `<div class="menu-panel" id="panel-desserts"><div class="menu-grid">${dessertMenu.map(i=>renderMenuCard(i.name,i.price,i.emoji,i.desc)).join('')}</div></div>`;

  panels.innerHTML = takoyakiHTML+osakaHTML+japaneseHTML+sidesHTML+drinksHTML+dessertsHTML;

  // Tab switching
  document.getElementById('menu-tabs').addEventListener('click',(e)=>{
    const btn=e.target.closest('.menu-tab');
    if(!btn) return;
    document.querySelectorAll('.menu-tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.menu-panel').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(`panel-${btn.dataset.panel}`).classList.add('active');
  });
}

function renderDeals() {
  const dealsData = [
    { title:"Friends & Family Pack", desc:"30 Takoyaki Balls for just Â¥2,400 â€“ that's 11% off! Perfect for sharing.", badge:"Best Value", action:()=>addToCart("Friends & Family Takoyaki Pack (30 Balls)",2400,1,true,{content:"30Ã— Classic Takoyaki"}) },
    { title:"ğŸ² Gamble Deal", desc:"19+ only. Spin your luck! Get 1â€“10 takoyaki at a random price. Are you brave enough?", badge:"19+", action:()=>gambleDeal() },
    { title:"Combo Meal", desc:"Takoyaki + Drink + Dessert for Â¥1,200. The perfect izakaya set.", badge:"Popular", action:()=>addToCart("Combo Meal (Takoyaki + Drink + Dessert)",1200,1,true,{content:"1Ã— Takoyaki, 1Ã— Drink, 1Ã— Dessert"}) },
    { title:"ğŸº Happy Hour Beer", desc:"Sapporo Beer for Â¥400 (normally Â¥600). Only available 5pmâ€“7pm!", badge:"Limited Hours", action:()=>happyHourDeal() },
    { title:"ğŸŒ¸ Seasonal Special", desc:"Sakura Mochi Ice Cream for Â¥350 â€“ limited time only!", badge:"Seasonal", action:()=>addToCart("Sakura Mochi Ice Cream",350,1,false,{}) },
    { title:"ğŸ¯ Limited Keychain", desc:"Osaka Castle Keychain for Â¥500 (normally Â¥1,000). While stocks last!", badge:"50% Off", action:()=>addToCart("Osaka Castle Keychain (Limited-Time)",500,1,false,{}) },
    { title:"ğŸ“¸ Social Media Contest", desc:"Post your meal, tag us, and win a takoyaki plushie! Show your post to staff.", badge:"Win Prizes", action:()=>toast("Post your meal on social media and show staff to enter! ğŸ“¸",'info') },
    { title:"ğŸ Loyalty Reward", desc:"Buy 5 meals, get 1 free! Tracked by your account. Log in to check progress.", badge:"Members Only", action:()=>checkLoyalty() }
  ];

  document.getElementById('deals-grid').innerHTML = dealsData.map(d=>`
    <div class="deal-card">
      <span class="deal-badge">${d.badge}</span>
      <div class="deal-card-title">${d.title}</div>
      <div class="deal-card-desc">${d.desc}</div>
      <button class="btn btn-sakura btn-sm" onclick="dealActions[${dealsData.indexOf(d)}]()">Claim Deal</button>
    </div>
  `).join('');

  window.dealActions=dealsData.map(d=>d.action);
}

function gambleDeal() {
  if((currentUser?.age||0)<19){ toast('Must be 19+ for the gamble deal','error'); return; }
  if(!confirm('Type OK to try your luck!')){ toast('Cancelled','info'); return; }
  const balls=Math.floor(Math.random()*10)+1;
  const yen=Math.floor(Math.random()*901)+100;
  addToCart(`Gamble Deal (${balls} Takoyaki)`,yen,1,true,{balls,price:yen});
}

function happyHourDeal() {
  const h=new Date().getHours();
  if(h>=17&&h<19){ addToCart("Sapporo Beer (Happy Hour)",400,1,false,{}); }
  else { toast(`Happy Hour is 5pmâ€“7pm (now ${h}:00)`,'error'); }
}

function checkLoyalty() {
  if(!currentUser?.email){ toast('Login required for loyalty program','error'); return; }
  const count=orders.filter(o=>o.email===currentUser.email).length;
  if(count>=5){ addToCart("Free Meal (Loyalty Reward)",0,1,true,{}); toast("ğŸ Free meal unlocked!",'success'); }
  else { toast(`You have ${count}/5 orders. ${5-count} more to go!`,'info'); }
}

function renderMerchandise() {
  document.getElementById('merch-grid').innerHTML = merchandiseMenu.map(i=>renderMenuCard(i.name,i.price,i.emoji,i.desc)).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ORDER HISTORY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderOrderHistory() {
  const el=document.getElementById('orders-list');
  if(!currentUser?.email){
    el.innerHTML=`<div class="empty-state"><span class="empty-state-icon">ğŸ”‘</span><div class="empty-state-text">Login to view your order history</div><div style="margin-top:16px;"><button class="btn btn-primary btn-sm" onclick="openAuthModal()">Login / Register</button></div></div>`;
    return;
  }
  const userOrders=orders.filter(o=>o.email===currentUser.email).reverse();
  if(userOrders.length===0){
    el.innerHTML=`<div class="empty-state"><span class="empty-state-icon">ğŸ§¾</span><div class="empty-state-text">No orders yet. Time to eat!</div></div>`;
    return;
  }
  el.innerHTML=userOrders.map(o=>{
    const statusMap={'Pending':'status-pending','Preparing':'status-preparing','Ready':'status-ready','Completed':'status-completed','Cancelled':'status-cancelled','Cash On Delivery':'status-cod'};
    const cls=statusMap[o.status]||'status-pending';
    return `
      <div class="order-card">
        <div class="order-card-header">
          <div>
            <div class="order-code">${o.orderCode}</div>
            <div style="font-size:12px;color:rgba(253,245,232,0.4);margin-top:3px;">${new Date(o.date).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'})}</div>
          </div>
          <span class="order-status ${cls}">${o.status}</span>
        </div>
        <div style="font-size:13px;color:rgba(253,245,232,0.55);margin-bottom:12px;">
          ${o.items.map(i=>`${i.quantity}Ã— ${i.name}`).join(' Â· ')}
        </div>
        <div style="display:flex;justify-content:space-between;font-family:'Noto Serif JP',serif;font-size:15px;">
          <span style="color:rgba(253,245,232,0.5);">Total</span>
          <span style="color:var(--amber);">Â¥${o.total.toLocaleString()}</span>
        </div>
      </div>
    `;
  }).join('');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN PANEL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAdminPanel() {
  const panel=document.getElementById('admin-panel');
  if(orders.length===0){ panel.innerHTML='<div style="color:rgba(253,245,232,0.4);font-style:italic;">No orders yet.</div>'; return; }
  const statusColors={'Pending':'#e8d060','Preparing':'#60b8e8','Ready':'#60e890','Completed':'#a0a0a0','Cancelled':'#e06060','Cash On Delivery':'var(--sakura)'};
  const statuses=["Pending","Preparing","Ready","Completed","Cancelled","Cash On Delivery"];

  panel.innerHTML=`
    <div style="font-family:'Shippori Mincho',serif;font-size:11px;letter-spacing:0.3em;text-transform:uppercase;color:#c080f0;margin-bottom:16px;">All Orders (${orders.length})</div>
    ${orders.slice().reverse().map((o,ri)=>{
      const i=orders.length-1-ri;
      return `
        <div style="border:1px solid rgba(100,60,160,0.25);border-radius:4px;padding:16px;margin-bottom:12px;background:rgba(60,20,80,0.15);">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;flex-wrap:wrap;gap:8px;">
            <div>
              <div style="font-family:'Noto Serif JP',serif;font-size:13px;color:var(--amber);">${o.orderCode}</div>
              <div style="font-size:12px;color:rgba(253,245,232,0.5);">${o.customer}${o.email?` Â· ${o.email}`:''}</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
              <select onchange="adminUpdateStatus(${i}, this.value)" style="background:#0f0a05;border:1px solid rgba(100,60,160,0.3);color:${statusColors[o.status]||'#fff'};padding:4px 10px;font-size:11px;border-radius:3px;cursor:pointer;font-family:'Shippori Mincho',serif;">
                ${statuses.map(s=>`<option value="${s}"${s===o.status?' selected':''}>${s}</option>`).join('')}
              </select>
              <button onclick="adminDeleteOrder(${i})" style="background:rgba(180,40,40,0.2);border:1px solid rgba(180,40,40,0.3);color:#e07070;font-size:11px;padding:4px 10px;border-radius:3px;cursor:pointer;font-family:'Shippori Mincho',serif;">Delete</button>
            </div>
          </div>
          <div style="font-size:12px;color:rgba(253,245,232,0.45);">${o.items.map(it=>`${it.quantity}Ã— ${it.name}`).join(' Â· ')}</div>
          <div style="font-size:13px;color:var(--amber);margin-top:8px;">Â¥${o.total.toLocaleString()} Â· ${new Date(o.date).toLocaleDateString()}</div>
        </div>
      `;
    }).join('')}
  `;
}

function adminUpdateStatus(idx, status) {
  orders[idx].status=status;
  saveData(ORDERS_KEY,orders);
  toast(`Order status updated to: ${status}`,'success');
  renderAdminPanel(); renderOrderHistory();
}

function adminDeleteOrder(idx) {
  if(!confirm('Delete this order?')) return;
  const code=orders[idx].orderCode;
  orders.splice(idx,1);
  saveData(ORDERS_KEY,orders);
  toast(`Order ${code} deleted`,'info');
  renderAdminPanel(); renderOrderHistory();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SAKURA PETAL CANVAS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function sakuraPetals(){
  const canvas=document.getElementById('petals-canvas');
  const ctx=canvas.getContext('2d');
  let petals=[];
  const PETAL_COUNT=22;

  function resize(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
  window.addEventListener('resize',resize); resize();

  function createPetal(){
    return {
      x: Math.random()*window.innerWidth,
      y: -20,
      r: 3+Math.random()*5,
      speed: 0.6+Math.random()*1.2,
      drift: (Math.random()-0.5)*0.8,
      rot: Math.random()*Math.PI*2,
      rotSpeed: (Math.random()-0.5)*0.04,
      opacity: 0.3+Math.random()*0.5,
      sway: Math.random()*Math.PI*2,
      swaySpeed: 0.01+Math.random()*0.02,
      swayAmt: 15+Math.random()*20,
      color: Math.random()<0.5?'#e8879c':'#f5c8d8'
    };
  }

  for(let i=0;i<PETAL_COUNT;i++){
    const p=createPetal();
    p.y=Math.random()*window.innerHeight;
    petals.push(p);
  }

  function drawPetal(p){
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.globalAlpha=p.opacity;
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.ellipse(0,0,p.r,p.r*0.6,0,0,Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    petals.forEach(p=>{
      p.sway+=p.swaySpeed;
      p.x+=p.drift+Math.sin(p.sway)*0.5;
      p.y+=p.speed;
      p.rot+=p.rotSpeed;
      drawPetal(p);
      if(p.y>window.innerHeight+20){ Object.assign(p,createPetal()); }
    });
    requestAnimationFrame(animate);
  }
  animate();
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SCROLL REVEAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function initScrollReveal(){
  const observer=new IntersectionObserver((entries)=>{
    entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); observer.unobserve(e.target); } });
  },{threshold:0.1});
  document.querySelectorAll('.reveal').forEach(el=>observer.observe(el));
}

function scrollToMenu(){ document.getElementById('menu').scrollIntoView({behavior:'smooth',block:'start'}); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  users=loadData(USERS_KEY);
  orders=loadData(ORDERS_KEY);
  currentUser={name:'Guest',age:18,email:null};

  renderAllMenus();
  renderDeals();
  renderMerchandise();
  updateUserBar();
  renderOrderHistory();
  initScrollReveal();
}

window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
